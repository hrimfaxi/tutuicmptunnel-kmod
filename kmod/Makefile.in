KVER ?= $(if $(KERNELRELEASE),$(KERNELRELEASE),$(shell uname -r))
KSRC ?= $(if $(KERNEL_SRC),$(KERNEL_SRC),/lib/modules/$(KVER)/build)
pwd=$(shell pwd)

obj-m := tutuicmptunnel.o
tutuicmptunnel-objs := tutu.o hashtab.o genl.o

EXTRA_CFLAGS := -g -Wall -Wuninitialized -Wno-unused-parameter -Wno-type-limits

all:
	make -C $(KSRC) M=$(pwd) modules

install modules_install:
	make -C $(KSRC) M=$(pwd) modules_install

clean:
	make -C $(KSRC) M=$(pwd) clean

dkms:
	make clean
	dkms add .
	dkms autoinstall

dkms-remove:
	dkms remove tutuicmptunnel/@CMAKE_PROJECT_VERSION@ --all
